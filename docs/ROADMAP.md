# Roadmap и технический долг

## Статус на сентябрь 2025
- [x] Telegram Login + привязка пользователей к `telegram_user_id`.
- [x] Кабинеты клиента и администратора (Next.js App Router).
- [x] REST API (FastAPI) + Redis очередь + PostgreSQL.
- [x] Мастер-бот (`@vishenka_play_bot`) и обмен link_token.
- [x] Двусторонняя интеграция Avito ↔ Telegram (poller + вебхук + worker).
- [x] Docker Compose окружение с Caddy (TLS), Redis, Postgres, worker.
- [x] Базовые сиды (admin, demo client, owner), документация по запуску и эксплуатации.

## Ближайшие приоритеты (0–4 недели)
1. **Мониторинг Avito poller**
   - Добавить метрики, алерты и персистентный лог на случай ошибок API.
   - Настроить уведомления при длительном отсутствии входящих сообщений.
2. **Надёжность очередей**
   - Реализовать повторную попытку и дедупликацию задач `avito.send_message`.
   - Добавить DLQ или журнал невыполненных сообщений.
3. **UX кабинета клиента**
   - Расширить формы валидацией, подсказками, индикацией статуса вебхука и Avito-аккаунта.
4. **Аутентификация и безопасность**
   - Добавить refresh токены и ручку `/api/auth/refresh`.
   - Реализовать logout/отзыв токена, настраиваемый срок жизни сессий.
5. **Инфраструктура**
   - Мониторинг (Prometheus/Grafana), централизованное логирование (Loki или ELK).
   - Автоматизация бэкапов Postgres и конфигурация retention.

## Среднесрочно (1–3 месяца)
- **Масштабирование Avito poller**: шардирование по аккаунтам, распределённые очереди и backoff при ошибках.
- **Аудит и аналитика**: расширить таблицы `audit`/`event`, добавить графики в админке.
- **Мульти-бот поддержка**: UI для переключения ботов, статусы вебхуков, health-check.
- **Права доступа**: разграничение ролей owner/manager внутри кабинета (`owner` может приглашать менеджеров).
- **Миграции**: перейти на Alembic для управления схемой БД.
- **Тестирование**: написать unit/интеграционные тесты (pytest + httpx + Playwright для фронта).

## Технический долг и риски
- **AvitoService**: нет retry/backoff и DLQ для несостоявшихся отправок.
- **Masterbot**: long polling (без webhooks) → на проде может потребоваться отдельный процесс / use case.
- **Валидация данных**: нет строгой проверки form input (боты, аккаунты).
- **Масштабирование**: очередь Redis без ack и dead-letter, нужно расширить при росте нагрузки.
- **Безопасность**: отсутствуют rate-limit, CSRF защита для cookie (используется только JWT в localStorage), нет 2FA.
- **DevOps**: нет CI/CD, автоматических тестов перед деплоем.

## Идеи для будущего
- Автоматическая настройка вебхуков Telegram для клиентских ботов из админки.
- Нотификации (email/Telegram) о неотвеченных диалогах.
- Визуальная шкала SLA и отчетность для клиентов.
- Интеграция с CRM и аналитикой (например, выгрузка в Google Sheets).
- Поддержка других площадок, кроме Авито.

> Приоритезация подлежит обсуждению с бизнес-стейкхолдерами. Таблица задач и сроки ведутся в отдельном PM-инструменте (TBD).
